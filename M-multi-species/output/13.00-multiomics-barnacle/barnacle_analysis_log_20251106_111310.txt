============================================================
BARNACLE ANALYSIS LOG
Started: 2025-11-06 11:13:10
Log file: ../output/13.00-multiomics-barnacle/barnacle_analysis_log_20251106_111310.txt
============================================================

Working in output directory: ../output/13.00-multiomics-barnacle
Loaded normalized data:
Apul: (10223, 41)
Peve: (10223, 37)
Ptua: (10223, 37)

Common genes across all species: 10223

Filtered to common genes:
Apul: (10223, 40)
Peve: (10223, 36)
Ptua: (10223, 36)
Parsing sample information for each species...
apul:
  Samples: 10 (['ACR.139', 'ACR.145', 'ACR.150']...)
  Timepoints: [1, 2, 3, 4]
peve:
  Samples: 9 (['POR.216', 'POR.245', 'POR.260']...)
  Timepoints: [1, 2, 3, 4]
ptua:
  Samples: 9 (['POC.219', 'POC.222', 'POC.255']...)
  Timepoints: [1, 2, 3, 4]

Timepoints found across all species: [1, 2, 3, 4]
Maximum samples in any species: 10

Detailed sample structure:
apul: 10 samples √ó 4 timepoints
peve: 9 samples √ó 4 timepoints
ptua: 9 samples √ó 4 timepoints
Creating 3D tensor by combining species and samples...
Note: R-level filtering has already removed samples without all 4 timepoints

Processing apul:
  Added ACR.139 with 4 timepoints: [1, 2, 3, 4]
  Added ACR.145 with 4 timepoints: [1, 2, 3, 4]
  Added ACR.150 with 4 timepoints: [1, 2, 3, 4]
  Added ACR.173 with 4 timepoints: [1, 2, 3, 4]
  Added ACR.186 with 4 timepoints: [1, 2, 3, 4]
  Added ACR.225 with 4 timepoints: [1, 2, 3, 4]
  Added ACR.229 with 4 timepoints: [1, 2, 3, 4]
  Added ACR.237 with 4 timepoints: [1, 2, 3, 4]
  Added ACR.244 with 4 timepoints: [1, 2, 3, 4]
  Added ACR.265 with 4 timepoints: [1, 2, 3, 4]

Processing peve:
  Added POR.216 with 4 timepoints: [1, 2, 3, 4]
  Added POR.245 with 4 timepoints: [1, 2, 3, 4]
  Added POR.260 with 4 timepoints: [1, 2, 3, 4]
  Added POR.262 with 4 timepoints: [1, 2, 3, 4]
  Added POR.69 with 4 timepoints: [1, 2, 3, 4]
  Added POR.72 with 4 timepoints: [1, 2, 3, 4]
  Added POR.73 with 4 timepoints: [1, 2, 3, 4]
  Added POR.74 with 4 timepoints: [1, 2, 3, 4]
  Added POR.83 with 4 timepoints: [1, 2, 3, 4]

Processing ptua:
  Added POC.219 with 4 timepoints: [1, 2, 3, 4]
  Added POC.222 with 4 timepoints: [1, 2, 3, 4]
  Added POC.255 with 4 timepoints: [1, 2, 3, 4]
  Added POC.259 with 4 timepoints: [1, 2, 3, 4]
  Added POC.40 with 4 timepoints: [1, 2, 3, 4]
  Added POC.42 with 4 timepoints: [1, 2, 3, 4]
  Added POC.52 with 4 timepoints: [1, 2, 3, 4]
  Added POC.53 with 4 timepoints: [1, 2, 3, 4]
  Added POC.57 with 4 timepoints: [1, 2, 3, 4]

Creating 3D tensor with shape: (10223, 28, 4)
Combined samples from all species: 28

=== TENSOR STATISTICS ===
Tensor shape: (10223, 28, 4)
Total elements: 1144976
Finite values: 1144976
Missing/NaN values: 0
Missing percentage: 0.00%
Filled 112 sample-timepoint combinations
Missing 0 sample-timepoint combinations
Non-zero finite values: 1128956
Zero finite values: 16020
Sparsity among finite values: 1.40%

Sample mapping:
   combined_index  sample_label species sample_id
0               0  apul_ACR.139    apul   ACR.139
1               1  apul_ACR.145    apul   ACR.145
2               2  apul_ACR.150    apul   ACR.150
3               3  apul_ACR.173    apul   ACR.173
4               4  apul_ACR.186    apul   ACR.186
5               5  apul_ACR.225    apul   ACR.225
6               6  apul_ACR.229    apul   ACR.229
7               7  apul_ACR.237    apul   ACR.237
8               8  apul_ACR.244    apul   ACR.244
9               9  apul_ACR.265    apul   ACR.265
Rank comparison helper functions loaded

============================================================
FACTOR MATCH SCORE (FMS) EVALUATION
============================================================
This analysis evaluates decomposition quality using the Factor Match Score
from the tensorly-viz (tlviz) library, which measures how well the
decomposed factors match the original tensor structure.
============================================================
Found 12 successful ranks to evaluate: [5, 8, 10, 12, 15, 20, 25, 35, 45, 55, 65, 75]

--- Evaluating FMS for Rank 5 ---
  Loaded factor matrices - Genes: (10223, 5), Samples: (28, 5), Time: (4, 5)
  Reconstruction FMS: 0.7601 (correlation: 0.5202)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 8 ---
  Loaded factor matrices - Genes: (10223, 8), Samples: (28, 8), Time: (4, 8)
  Reconstruction FMS: 0.8003 (correlation: 0.6005)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 10 ---
  Loaded factor matrices - Genes: (10223, 10), Samples: (28, 10), Time: (4, 10)
  Reconstruction FMS: 0.8225 (correlation: 0.6451)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 12 ---
  Loaded factor matrices - Genes: (10223, 12), Samples: (28, 12), Time: (4, 12)
  Reconstruction FMS: 0.8398 (correlation: 0.6797)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 15 ---
  Loaded factor matrices - Genes: (10223, 15), Samples: (28, 15), Time: (4, 15)
  Reconstruction FMS: 0.8610 (correlation: 0.7219)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 20 ---
  Loaded factor matrices - Genes: (10223, 20), Samples: (28, 20), Time: (4, 20)
  Reconstruction FMS: 0.8863 (correlation: 0.7726)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 25 ---
  Loaded factor matrices - Genes: (10223, 25), Samples: (28, 25), Time: (4, 25)
  Reconstruction FMS: 0.9059 (correlation: 0.8118)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 35 ---
  Loaded factor matrices - Genes: (10223, 35), Samples: (28, 35), Time: (4, 35)
  Reconstruction FMS: 0.9341 (correlation: 0.8681)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 45 ---
  Loaded factor matrices - Genes: (10223, 45), Samples: (28, 45), Time: (4, 45)
  Reconstruction FMS: 0.9533 (correlation: 0.9066)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 55 ---
  Loaded factor matrices - Genes: (10223, 55), Samples: (28, 55), Time: (4, 55)
  Reconstruction FMS: 0.9663 (correlation: 0.9326)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 65 ---
  Loaded factor matrices - Genes: (10223, 65), Samples: (28, 65), Time: (4, 65)
  Reconstruction FMS: 0.9761 (correlation: 0.9523)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 75 ---
  Loaded factor matrices - Genes: (10223, 75), Samples: (28, 75), Time: (4, 75)
  Reconstruction FMS: 0.9838 (correlation: 0.9676)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

============================================================
FMS RESULTS SUMMARY
============================================================
Saved FMS comparison table to: ../output/13.00-multiomics-barnacle/rank_comparison/factor_match_scores.csv

Factor Match Score Results:
 rank  fms_tlviz  fms_reconstruction  reconstruction_correlation
    5        NaN              0.7601                      0.5202
    8        NaN              0.8003                      0.6005
   10        NaN              0.8225                      0.6451
   12        NaN              0.8398                      0.6797
   15        NaN              0.8610                      0.7219
   20        NaN              0.8863                      0.7726
   25        NaN              0.9059                      0.8118
   35        NaN              0.9341                      0.8681
   45        NaN              0.9533                      0.9066
   55        NaN              0.9663                      0.9326
   65        NaN              0.9761                      0.9523
   75        NaN              0.9838                      0.9676

============================================================
NOTE: TLViz FMS unavailable (scipy version incompatibility)
============================================================
This is expected and normal with scipy >= 1.14.
The Reconstruction FMS provides equivalent functionality.
============================================================
[<matplotlib.lines.Line2D object at 0x77c04f159510>]
Text(0.5, 0, 'Rank (Number of Components)')
Text(0, 0.5, 'Factor Match Score')
Text(0.5, 1.0, 'Factor Match Score vs Rank\n(Reconstruction-based FMS - Primary Metric)')
<matplotlib.legend.Legend object at 0x77c079c6e210>
(0.0, 1.05)
[<matplotlib.lines.Line2D object at 0x77c0466617d0>]
<matplotlib.lines.Line2D object at 0x77c0f1804ed0>
<matplotlib.lines.Line2D object at 0x77c0f21a9f90>
Text(0.5, 0, 'Rank (Number of Components)')
Text(0, 0.5, 'Reconstruction Correlation')
Text(0.5, 1.0, 'Tensor Reconstruction Quality vs Rank\n(Correlation between original and reconstructed)')
<matplotlib.legend.Legend object at 0x77c04e993ed0>
(-1.05, 1.05)
Saved FMS plot to: ../output/13.00-multiomics-barnacle/rank_comparison/factor_match_scores_plot.png

============================================================
FMS-BASED RANK RECOMMENDATION
============================================================
Best Reconstruction FMS: Rank 75 (score: 0.9838)
Best Reconstruction Correlation: Rank 75 (score: 0.9676)
TLViz FMS: Not available (SciPy compatibility issue)

High-scoring ranks (top 20%): [55, 65, 75]
Threshold: 0.9637

FMS Interpretation:
‚Ä¢ Reconstruction FMS is the PRIMARY metric for rank selection
  - Measures tensor reconstruction quality (0-1 scale)
  - Based on correlation between original and decomposed tensors
‚Ä¢ Reconstruction correlation shows direct fit quality (-1 to 1)
  - Values > 0.9 indicate excellent reconstruction
  - Values > 0.8 indicate good reconstruction
‚Ä¢ Higher scores = better factor recovery and model fit
‚Ä¢ Consider ranks with consistently high Reconstruction FMS (top 20%)

Note: TLViz FMS unavailable due to scipy >= 1.14 incompatibility
      (This is normal and does not affect analysis quality)

============================================================
FACTOR MATCH SCORE EVALUATION COMPLETE
============================================================
Summary: 12/12 ranks have valid Reconstruction FMS
         0/12 ranks have valid TLViz FMS
‚Üí Use Reconstruction FMS and correlation for rank selection

============================================================
FACTOR MATCH SCORE (FMS) EVALUATION
============================================================
This analysis evaluates decomposition quality using the Factor Match Score
from the tensorly-viz (tlviz) library, which measures how well the
decomposed factors match the original tensor structure.
============================================================
Found 12 successful ranks to evaluate: [5, 8, 10, 12, 15, 20, 25, 35, 45, 55, 65, 75]

--- Evaluating FMS for Rank 5 ---
  Loaded factor matrices - Genes: (10223, 5), Samples: (28, 5), Time: (4, 5)
  TLViz FMS: Failed - 'MockDecomposition' object is not subscriptable (method: failed)
  Reconstruction FMS: 0.7601 (correlation: 0.5202)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 8 ---
  Loaded factor matrices - Genes: (10223, 8), Samples: (28, 8), Time: (4, 8)
  TLViz FMS: Failed - 'MockDecomposition' object is not subscriptable (method: failed)
  Reconstruction FMS: 0.8003 (correlation: 0.6005)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 10 ---
  Loaded factor matrices - Genes: (10223, 10), Samples: (28, 10), Time: (4, 10)
  TLViz FMS: Failed - 'MockDecomposition' object is not subscriptable (method: failed)
  Reconstruction FMS: 0.8225 (correlation: 0.6451)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 12 ---
  Loaded factor matrices - Genes: (10223, 12), Samples: (28, 12), Time: (4, 12)
  TLViz FMS: Failed - 'MockDecomposition' object is not subscriptable (method: failed)
  Reconstruction FMS: 0.8398 (correlation: 0.6797)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 15 ---
  Loaded factor matrices - Genes: (10223, 15), Samples: (28, 15), Time: (4, 15)
  TLViz FMS: Failed - 'MockDecomposition' object is not subscriptable (method: failed)
  Reconstruction FMS: 0.8610 (correlation: 0.7219)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 20 ---
  Loaded factor matrices - Genes: (10223, 20), Samples: (28, 20), Time: (4, 20)
  TLViz FMS: Failed - 'MockDecomposition' object is not subscriptable (method: failed)
  Reconstruction FMS: 0.8863 (correlation: 0.7726)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 25 ---
  Loaded factor matrices - Genes: (10223, 25), Samples: (28, 25), Time: (4, 25)
  TLViz FMS: Failed - 'MockDecomposition' object is not subscriptable (method: failed)
  Reconstruction FMS: 0.9059 (correlation: 0.8118)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 35 ---
  Loaded factor matrices - Genes: (10223, 35), Samples: (28, 35), Time: (4, 35)
  TLViz FMS: Failed - 'MockDecomposition' object is not subscriptable (method: failed)
  Reconstruction FMS: 0.9341 (correlation: 0.8681)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 45 ---
  Loaded factor matrices - Genes: (10223, 45), Samples: (28, 45), Time: (4, 45)
  TLViz FMS: Failed - 'MockDecomposition' object is not subscriptable (method: failed)
  Reconstruction FMS: 0.9533 (correlation: 0.9066)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 55 ---
  Loaded factor matrices - Genes: (10223, 55), Samples: (28, 55), Time: (4, 55)
  TLViz FMS: Failed - 'MockDecomposition' object is not subscriptable (method: failed)
  Reconstruction FMS: 0.9663 (correlation: 0.9326)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 65 ---
  Loaded factor matrices - Genes: (10223, 65), Samples: (28, 65), Time: (4, 65)
  TLViz FMS: Failed - 'MockDecomposition' object is not subscriptable (method: failed)
  Reconstruction FMS: 0.9761 (correlation: 0.9523)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 75 ---
  Loaded factor matrices - Genes: (10223, 75), Samples: (28, 75), Time: (4, 75)
  TLViz FMS: Failed - 'MockDecomposition' object is not subscriptable (method: failed)
  Reconstruction FMS: 0.9838 (correlation: 0.9676)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

============================================================
FMS RESULTS SUMMARY
============================================================
Saved FMS comparison table to: ../output/13.00-multiomics-barnacle/rank_comparison/factor_match_scores.csv

Factor Match Score Results:
 rank  fms_tlviz  fms_reconstruction  reconstruction_correlation
    5        NaN              0.7601                      0.5202
    8        NaN              0.8003                      0.6005
   10        NaN              0.8225                      0.6451
   12        NaN              0.8398                      0.6797
   15        NaN              0.8610                      0.7219
   20        NaN              0.8863                      0.7726
   25        NaN              0.9059                      0.8118
   35        NaN              0.9341                      0.8681
   45        NaN              0.9533                      0.9066
   55        NaN              0.9663                      0.9326
   65        NaN              0.9761                      0.9523
   75        NaN              0.9838                      0.9676

============================================================
NOTE: TLViz FMS unavailable (scipy version incompatibility)
============================================================
This is expected and normal with scipy >= 1.14.
The Reconstruction FMS provides equivalent functionality.
============================================================
[<matplotlib.lines.Line2D object at 0x77c046354750>]
Text(0.5, 0, 'Rank (Number of Components)')
Text(0, 0.5, 'Factor Match Score')
Text(0.5, 1.0, 'Factor Match Score vs Rank\n(Reconstruction-based FMS - Primary Metric)')
<matplotlib.legend.Legend object at 0x77c0f1814b90>
(0.0, 1.05)
[<matplotlib.lines.Line2D object at 0x77c046356610>]
<matplotlib.lines.Line2D object at 0x77c046357f10>
<matplotlib.lines.Line2D object at 0x77c04635d3d0>
Text(0.5, 0, 'Rank (Number of Components)')
Text(0, 0.5, 'Reconstruction Correlation')
Text(0.5, 1.0, 'Tensor Reconstruction Quality vs Rank\n(Correlation between original and reconstructed)')
<matplotlib.legend.Legend object at 0x77c0462e5190>
(-1.05, 1.05)
Saved FMS plot to: ../output/13.00-multiomics-barnacle/rank_comparison/factor_match_scores_plot.png

============================================================
FMS-BASED RANK RECOMMENDATION
============================================================
Best Reconstruction FMS: Rank 75 (score: 0.9838)
Best Reconstruction Correlation: Rank 75 (score: 0.9676)
TLViz FMS: Not available (SciPy compatibility issue)

High-scoring ranks (top 20%): [55, 65, 75]
Threshold: 0.9637

FMS Interpretation:
‚Ä¢ Reconstruction FMS is the PRIMARY metric for rank selection
  - Measures tensor reconstruction quality (0-1 scale)
  - Based on correlation between original and decomposed tensors
‚Ä¢ Reconstruction correlation shows direct fit quality (-1 to 1)
  - Values > 0.9 indicate excellent reconstruction
  - Values > 0.8 indicate good reconstruction
‚Ä¢ Higher scores = better factor recovery and model fit
‚Ä¢ Consider ranks with consistently high Reconstruction FMS (top 20%)

Note: TLViz FMS unavailable due to scipy >= 1.14 incompatibility
      (This is normal and does not affect analysis quality)

============================================================
FACTOR MATCH SCORE EVALUATION COMPLETE
============================================================
Summary: 12/12 ranks have valid Reconstruction FMS
         0/12 ranks have valid TLViz FMS
‚Üí Use Reconstruction FMS and correlation for rank selection

============================================================
FACTOR MATCH SCORE (FMS) EVALUATION
============================================================
This analysis evaluates decomposition quality using the Factor Match Score
from the tensorly-viz (tlviz) library, which measures how well the
decomposed factors match the original tensor structure.
============================================================
Found 12 successful ranks to evaluate: [5, 8, 10, 12, 15, 20, 25, 35, 45, 55, 65, 75]

--- Evaluating FMS for Rank 5 ---
  Loaded factor matrices - Genes: (10223, 5), Samples: (28, 5), Time: (4, 5)
  TLViz FMS: 1.0000 ‚úÖ
  Reconstruction FMS: 0.7601 (correlation: 0.5202)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 8 ---
  Loaded factor matrices - Genes: (10223, 8), Samples: (28, 8), Time: (4, 8)
  TLViz FMS: 1.0000 ‚úÖ
  Reconstruction FMS: 0.8003 (correlation: 0.6005)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 10 ---
  Loaded factor matrices - Genes: (10223, 10), Samples: (28, 10), Time: (4, 10)
  TLViz FMS: 1.0000 ‚úÖ
  Reconstruction FMS: 0.8225 (correlation: 0.6451)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 12 ---
  Loaded factor matrices - Genes: (10223, 12), Samples: (28, 12), Time: (4, 12)
  TLViz FMS: 1.0000 ‚úÖ
  Reconstruction FMS: 0.8398 (correlation: 0.6797)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 15 ---
  Loaded factor matrices - Genes: (10223, 15), Samples: (28, 15), Time: (4, 15)
  TLViz FMS: 1.0000 ‚úÖ
  Reconstruction FMS: 0.8610 (correlation: 0.7219)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 20 ---
  Loaded factor matrices - Genes: (10223, 20), Samples: (28, 20), Time: (4, 20)
  TLViz FMS: 1.0000 ‚úÖ
  Reconstruction FMS: 0.8863 (correlation: 0.7726)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 25 ---
  Loaded factor matrices - Genes: (10223, 25), Samples: (28, 25), Time: (4, 25)
  TLViz FMS: 1.0000 ‚úÖ
  Reconstruction FMS: 0.9059 (correlation: 0.8118)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 35 ---
  Loaded factor matrices - Genes: (10223, 35), Samples: (28, 35), Time: (4, 35)
  TLViz FMS: 1.0000 ‚úÖ
  Reconstruction FMS: 0.9341 (correlation: 0.8681)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 45 ---
  Loaded factor matrices - Genes: (10223, 45), Samples: (28, 45), Time: (4, 45)
  TLViz FMS: 1.0000 ‚úÖ
  Reconstruction FMS: 0.9533 (correlation: 0.9066)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 55 ---
  Loaded factor matrices - Genes: (10223, 55), Samples: (28, 55), Time: (4, 55)
  TLViz FMS: 1.0000 ‚úÖ
  Reconstruction FMS: 0.9663 (correlation: 0.9326)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 65 ---
  Loaded factor matrices - Genes: (10223, 65), Samples: (28, 65), Time: (4, 65)
  TLViz FMS: 1.0000 ‚úÖ
  Reconstruction FMS: 0.9761 (correlation: 0.9523)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 75 ---
  Loaded factor matrices - Genes: (10223, 75), Samples: (28, 75), Time: (4, 75)
  TLViz FMS: 1.0000 ‚úÖ
  Reconstruction FMS: 0.9838 (correlation: 0.9676)
  Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

============================================================
FMS RESULTS SUMMARY
============================================================
Saved FMS comparison table to: ../output/13.00-multiomics-barnacle/rank_comparison/factor_match_scores.csv

Factor Match Score Results:
 rank  fms_tlviz  fms_reconstruction  reconstruction_correlation
    5     1.0000              0.7601                      0.5202
    8     1.0000              0.8003                      0.6005
   10     1.0000              0.8225                      0.6451
   12     1.0000              0.8398                      0.6797
   15     1.0000              0.8610                      0.7219
   20     1.0000              0.8863                      0.7726
   25     1.0000              0.9059                      0.8118
   35     1.0000              0.9341                      0.8681
   45     1.0000              0.9533                      0.9066
   55     1.0000              0.9663                      0.9326
   65     1.0000              0.9761                      0.9523
   75     1.0000              0.9838                      0.9676
[<matplotlib.lines.Line2D object at 0x77c04625fd90>]
[<matplotlib.lines.Line2D object at 0x77c04626b750>]
Text(0.5, 0, 'Rank (Number of Components)')
Text(0, 0.5, 'Factor Match Score')
Text(0.5, 1.0, 'Factor Match Score vs Rank\n(Higher = Better Factor Recovery)')
<matplotlib.legend.Legend object at 0x77c0f218c810>
(0.0, 1.05)
[<matplotlib.lines.Line2D object at 0x77c0462656d0>]
<matplotlib.lines.Line2D object at 0x77c046269b50>
<matplotlib.lines.Line2D object at 0x77c04630d250>
Text(0.5, 0, 'Rank (Number of Components)')
Text(0, 0.5, 'Reconstruction Correlation')
Text(0.5, 1.0, 'Tensor Reconstruction Quality vs Rank\n(Correlation between original and reconstructed)')
<matplotlib.legend.Legend object at 0x77c046257850>
(-1.05, 1.05)
Saved FMS plot to: ../output/13.00-multiomics-barnacle/rank_comparison/factor_match_scores_plot.png

============================================================
FMS-BASED RANK RECOMMENDATION
============================================================
Best Reconstruction FMS: Rank 75 (score: 0.9838)
Best Reconstruction Correlation: Rank 75 (score: 0.9676)
Best TLViz FMS: Rank 10 (score: 1.0000)

High-scoring ranks (top 20%): [55, 65, 75]
Threshold: 0.9637

FMS Interpretation:
‚Ä¢ Reconstruction FMS is the PRIMARY metric for rank selection
  - Measures tensor reconstruction quality (0-1 scale)
  - Based on correlation between original and decomposed tensors
‚Ä¢ Reconstruction correlation shows direct fit quality (-1 to 1)
  - Values > 0.9 indicate excellent reconstruction
  - Values > 0.8 indicate good reconstruction
‚Ä¢ Higher scores = better factor recovery and model fit
‚Ä¢ Consider ranks with consistently high Reconstruction FMS (top 20%)
‚Ä¢ TLViz FMS available and can be used for additional validation

============================================================
FACTOR MATCH SCORE EVALUATION COMPLETE
============================================================
Summary: 12/12 ranks have valid Reconstruction FMS
         12/12 ranks have valid TLViz FMS
‚Üí Use Reconstruction FMS and correlation for rank selection

============================================================
FACTOR MATCH SCORE (FMS) EVALUATION
============================================================
This analysis evaluates decomposition quality using the Factor Match Score
from the tensorly-viz (tlviz) library, which measures how well the
decomposed factors match the original tensor structure.
============================================================
Found 12 successful ranks to evaluate: [5, 8, 10, 12, 15, 20, 25, 35, 45, 55, 65, 75]

--- Evaluating FMS for Rank 5 ---
  Loaded factor matrices - Genes: (10223, 5), Samples: (28, 5), Time: (4, 5)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.7601 (correlation: 0.5202) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 8 ---
  Loaded factor matrices - Genes: (10223, 8), Samples: (28, 8), Time: (4, 8)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.8003 (correlation: 0.6005) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 10 ---
  Loaded factor matrices - Genes: (10223, 10), Samples: (28, 10), Time: (4, 10)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.8225 (correlation: 0.6451) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 12 ---
  Loaded factor matrices - Genes: (10223, 12), Samples: (28, 12), Time: (4, 12)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.8398 (correlation: 0.6797) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 15 ---
  Loaded factor matrices - Genes: (10223, 15), Samples: (28, 15), Time: (4, 15)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.8610 (correlation: 0.7219) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 20 ---
  Loaded factor matrices - Genes: (10223, 20), Samples: (28, 20), Time: (4, 20)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.8863 (correlation: 0.7726) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 25 ---
  Loaded factor matrices - Genes: (10223, 25), Samples: (28, 25), Time: (4, 25)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.9059 (correlation: 0.8118) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 35 ---
  Loaded factor matrices - Genes: (10223, 35), Samples: (28, 35), Time: (4, 35)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.9341 (correlation: 0.8681) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 45 ---
  Loaded factor matrices - Genes: (10223, 45), Samples: (28, 45), Time: (4, 45)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.9533 (correlation: 0.9066) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 55 ---
  Loaded factor matrices - Genes: (10223, 55), Samples: (28, 55), Time: (4, 55)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.9663 (correlation: 0.9326) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 65 ---
  Loaded factor matrices - Genes: (10223, 65), Samples: (28, 65), Time: (4, 65)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.9761 (correlation: 0.9523) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 75 ---
  Loaded factor matrices - Genes: (10223, 75), Samples: (28, 75), Time: (4, 75)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.9838 (correlation: 0.9676) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

============================================================
FMS RESULTS SUMMARY
============================================================
Saved FMS comparison table to: ../output/13.00-multiomics-barnacle/rank_comparison/factor_match_scores.csv

============================================================
FACTOR MATCH SCORE RESULTS
============================================================
‚ö†Ô∏è  NOTE: TLViz FMS compares decomposition to itself (always ~1.0)
‚≠ê  USE RECONSTRUCTION FMS for rank selection (compares to original tensor)
============================================================
 rank  fms_tlviz  fms_reconstruction  reconstruction_correlation
    5     1.0000              0.7601                      0.5202
    8     1.0000              0.8003                      0.6005
   10     1.0000              0.8225                      0.6451
   12     1.0000              0.8398                      0.6797
   15     1.0000              0.8610                      0.7219
   20     1.0000              0.8863                      0.7726
   25     1.0000              0.9059                      0.8118
   35     1.0000              0.9341                      0.8681
   45     1.0000              0.9533                      0.9066
   55     1.0000              0.9663                      0.9326
   65     1.0000              0.9761                      0.9523
   75     1.0000              0.9838                      0.9676

============================================================
‚ö†Ô∏è  WARNING: TLViz FMS shows all values near 1.0
============================================================
This indicates self-comparison (decomposition vs itself).
This is NOT useful for rank selection.
‚Üí USE RECONSTRUCTION FMS instead (varies by rank: 0.76-0.98)
============================================================
[<matplotlib.lines.Line2D object at 0x77c04619dc50>]
[<matplotlib.lines.Line2D object at 0x77c0461a7b10>]
Text(0.5, 0, 'Rank (Number of Components)')
Text(0, 0.5, 'Factor Match Score')
Text(0.5, 1.0, 'Factor Match Score vs Rank\n(Higher = Better Factor Recovery)')
<matplotlib.legend.Legend object at 0x77c046191a50>
(0.0, 1.05)
[<matplotlib.lines.Line2D object at 0x77c0461a3c50>]
<matplotlib.lines.Line2D object at 0x77c046267710>
<matplotlib.lines.Line2D object at 0x77c0461a27d0>
Text(0.5, 0, 'Rank (Number of Components)')
Text(0, 0.5, 'Reconstruction Correlation')
Text(0.5, 1.0, 'Tensor Reconstruction Quality vs Rank\n(Correlation between original and reconstructed)')
<matplotlib.legend.Legend object at 0x77c04611fcd0>
(-1.05, 1.05)
Saved FMS plot to: ../output/13.00-multiomics-barnacle/rank_comparison/factor_match_scores_plot.png

============================================================
FMS-BASED RANK RECOMMENDATION
============================================================
Best Reconstruction FMS: Rank 75 (score: 0.9838)
Best Reconstruction Correlation: Rank 75 (score: 0.9676)
Best TLViz FMS: Rank 10 (score: 1.0000)

High-scoring ranks (top 20%): [55, 65, 75]
Threshold: 0.9637

FMS Interpretation:
‚Ä¢ Reconstruction FMS is the PRIMARY metric for rank selection
  - Measures tensor reconstruction quality (0-1 scale)
  - Based on correlation between original and decomposed tensors
‚Ä¢ Reconstruction correlation shows direct fit quality (-1 to 1)
  - Values > 0.9 indicate excellent reconstruction
  - Values > 0.8 indicate good reconstruction
‚Ä¢ Higher scores = better factor recovery and model fit
‚Ä¢ Consider ranks with consistently high Reconstruction FMS (top 20%)
‚Ä¢ TLViz FMS available and can be used for additional validation

============================================================
FACTOR MATCH SCORE EVALUATION COMPLETE
============================================================
Summary: 12/12 ranks have valid Reconstruction FMS
         12/12 ranks have valid TLViz FMS
‚Üí Use Reconstruction FMS and correlation for rank selection

============================================================
FACTOR MATCH SCORE (FMS) EVALUATION
============================================================
This analysis evaluates decomposition quality using the Factor Match Score
from the tensorly-viz (tlviz) library, which measures how well the
decomposed factors match the original tensor structure.
============================================================
Found 12 successful ranks to evaluate: [5, 8, 10, 12, 15, 20, 25, 35, 45, 55, 65, 75]

--- Evaluating FMS for Rank 5 ---
  Loaded factor matrices - Genes: (10223, 5), Samples: (28, 5), Time: (4, 5)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.7601 (correlation: 0.5202) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 8 ---
  Loaded factor matrices - Genes: (10223, 8), Samples: (28, 8), Time: (4, 8)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.8003 (correlation: 0.6005) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 10 ---
  Loaded factor matrices - Genes: (10223, 10), Samples: (28, 10), Time: (4, 10)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.8225 (correlation: 0.6451) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 12 ---
  Loaded factor matrices - Genes: (10223, 12), Samples: (28, 12), Time: (4, 12)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.8398 (correlation: 0.6797) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 15 ---
  Loaded factor matrices - Genes: (10223, 15), Samples: (28, 15), Time: (4, 15)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.8610 (correlation: 0.7219) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 20 ---
  Loaded factor matrices - Genes: (10223, 20), Samples: (28, 20), Time: (4, 20)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.8863 (correlation: 0.7726) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 25 ---
  Loaded factor matrices - Genes: (10223, 25), Samples: (28, 25), Time: (4, 25)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.9059 (correlation: 0.8118) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 35 ---
  Loaded factor matrices - Genes: (10223, 35), Samples: (28, 35), Time: (4, 35)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.9341 (correlation: 0.8681) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 45 ---
  Loaded factor matrices - Genes: (10223, 45), Samples: (28, 45), Time: (4, 45)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.9533 (correlation: 0.9066) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 55 ---
  Loaded factor matrices - Genes: (10223, 55), Samples: (28, 55), Time: (4, 55)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.9663 (correlation: 0.9326) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 65 ---
  Loaded factor matrices - Genes: (10223, 65), Samples: (28, 65), Time: (4, 65)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.9761 (correlation: 0.9523) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 75 ---
  Loaded factor matrices - Genes: (10223, 75), Samples: (28, 75), Time: (4, 75)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.9838 (correlation: 0.9676) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  Saved FMS results to: factor_match_score.json

============================================================
FMS RESULTS SUMMARY
============================================================
Saved FMS comparison table to: ../output/13.00-multiomics-barnacle/rank_comparison/factor_match_scores.csv

============================================================
FACTOR MATCH SCORE RESULTS
============================================================
‚ö†Ô∏è  NOTE: TLViz FMS compares decomposition to itself (always ~1.0)
‚≠ê  USE RECONSTRUCTION FMS for rank selection (compares to original tensor)
============================================================
 rank  fms_tlviz  fms_reconstruction  reconstruction_correlation
    5     1.0000              0.7601                      0.5202
    8     1.0000              0.8003                      0.6005
   10     1.0000              0.8225                      0.6451
   12     1.0000              0.8398                      0.6797
   15     1.0000              0.8610                      0.7219
   20     1.0000              0.8863                      0.7726
   25     1.0000              0.9059                      0.8118
   35     1.0000              0.9341                      0.8681
   45     1.0000              0.9533                      0.9066
   55     1.0000              0.9663                      0.9326
   65     1.0000              0.9761                      0.9523
   75     1.0000              0.9838                      0.9676

============================================================
‚ö†Ô∏è  WARNING: TLViz FMS shows all values near 1.0
============================================================
This indicates self-comparison (decomposition vs itself).
This is NOT useful for rank selection.
‚Üí USE RECONSTRUCTION FMS instead (varies by rank: 0.76-0.98)
============================================================
[<matplotlib.lines.Line2D object at 0x77c046072290>]
[<matplotlib.lines.Line2D object at 0x77c045ec77d0>]
Text(0.5, 0, 'Rank (Number of Components)')
Text(0, 0.5, 'Factor Match Score')
Text(0.5, 1.0, 'Factor Match Score vs Rank\n(Higher = Better Factor Recovery)')
<matplotlib.legend.Legend object at 0x77c046014050>
(0.0, 1.05)
[<matplotlib.lines.Line2D object at 0x77c045edcb90>]
<matplotlib.lines.Line2D object at 0x77c046016dd0>
<matplotlib.lines.Line2D object at 0x77c045ed8290>
Text(0.5, 0, 'Rank (Number of Components)')
Text(0, 0.5, 'Reconstruction Correlation')
Text(0.5, 1.0, 'Tensor Reconstruction Quality vs Rank\n(Correlation between original and reconstructed)')
<matplotlib.legend.Legend object at 0x77c046017cd0>
(-1.05, 1.05)
Saved FMS plot to: ../output/13.00-multiomics-barnacle/rank_comparison/factor_match_scores_plot.png

============================================================
FMS-BASED RANK RECOMMENDATION
============================================================
Best Reconstruction FMS: Rank 75 (score: 0.9838)
Best Reconstruction Correlation: Rank 75 (score: 0.9676)
Best TLViz FMS: Rank 10 (score: 1.0000)

High-scoring ranks (top 20%): [55, 65, 75]
Threshold: 0.9637

FMS Interpretation:
‚Ä¢ Reconstruction FMS is the PRIMARY metric for rank selection
  - Measures tensor reconstruction quality (0-1 scale)
  - Based on correlation between original and decomposed tensors
‚Ä¢ Reconstruction correlation shows direct fit quality (-1 to 1)
  - Values > 0.9 indicate excellent reconstruction
  - Values > 0.8 indicate good reconstruction
‚Ä¢ Higher scores = better factor recovery and model fit
‚Ä¢ Consider ranks with consistently high Reconstruction FMS (top 20%)
‚Ä¢ TLViz FMS available and can be used for additional validation

============================================================
FACTOR MATCH SCORE EVALUATION COMPLETE
============================================================
Summary: 12/12 ranks have valid Reconstruction FMS
         12/12 ranks have valid TLViz FMS
‚Üí Use Reconstruction FMS and correlation for rank selection

============================================================
FACTOR MATCH SCORE (FMS) EVALUATION
============================================================
This analysis evaluates decomposition quality using the Factor Match Score
from the tensorly-viz (tlviz) library, which measures how well the
decomposed factors match the original tensor structure.
============================================================
Found 12 successful ranks to evaluate: [5, 8, 10, 12, 15, 20, 25, 35, 45, 55, 65, 75]

============================================================
‚ö†Ô∏è  SYNTHETIC VALIDATION ENABLED
============================================================
This will test factor recovery by:
  1. Creating synthetic tensor from each decomposition
  2. Adding noise to test robustness
  3. Re-decomposing to see if factors are recovered
Expected additional time: 18-24 minutes
============================================================


--- Evaluating FMS for Rank 5 ---
  Loaded factor matrices - Genes: (10223, 5), Samples: (28, 5), Time: (4, 5)
  Running synthetic validation (this may take 1-2 minutes)...
/home/shared/barnacle/barnacle/decomposition.py:268: UserWarning: Algorithm failed to converge after 5000 iterations
  warnings.warn(message)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.7601 (correlation: 0.5202) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  üî¨ SYNTHETIC FMS: 0.6170 (fair recovery with 10% noise)
     ‚Ü≥ Tests factor recovery robustness
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 8 ---
  Loaded factor matrices - Genes: (10223, 8), Samples: (28, 8), Time: (4, 8)
  Running synthetic validation (this may take 1-2 minutes)...
/home/shared/barnacle/barnacle/decomposition.py:268: UserWarning: Algorithm failed to converge after 5000 iterations
  warnings.warn(message)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.8003 (correlation: 0.6005) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  üî¨ SYNTHETIC FMS: 0.6859 (fair recovery with 10% noise)
     ‚Ü≥ Tests factor recovery robustness
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 10 ---
  Loaded factor matrices - Genes: (10223, 10), Samples: (28, 10), Time: (4, 10)
  Running synthetic validation (this may take 1-2 minutes)...
/home/shared/barnacle/barnacle/decomposition.py:268: UserWarning: Algorithm failed to converge after 5000 iterations
  warnings.warn(message)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.8225 (correlation: 0.6451) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  üî¨ SYNTHETIC FMS: 0.9071 (excellent recovery with 10% noise)
     ‚Ü≥ Tests factor recovery robustness
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 12 ---
  Loaded factor matrices - Genes: (10223, 12), Samples: (28, 12), Time: (4, 12)
  Running synthetic validation (this may take 1-2 minutes)...
/home/shared/barnacle/barnacle/decomposition.py:268: UserWarning: Algorithm failed to converge after 5000 iterations
  warnings.warn(message)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.8398 (correlation: 0.6797) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  üî¨ SYNTHETIC FMS: 0.5074 (fair recovery with 10% noise)
     ‚Ü≥ Tests factor recovery robustness
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 15 ---
  Loaded factor matrices - Genes: (10223, 15), Samples: (28, 15), Time: (4, 15)
  Running synthetic validation (this may take 1-2 minutes)...
/home/shared/barnacle/barnacle/decomposition.py:268: UserWarning: Algorithm failed to converge after 5000 iterations
  warnings.warn(message)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.8610 (correlation: 0.7219) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  üî¨ SYNTHETIC FMS: 0.7324 (good recovery with 10% noise)
     ‚Ü≥ Tests factor recovery robustness
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 20 ---
  Loaded factor matrices - Genes: (10223, 20), Samples: (28, 20), Time: (4, 20)
  Running synthetic validation (this may take 1-2 minutes)...
/home/shared/barnacle/barnacle/decomposition.py:268: UserWarning: Algorithm failed to converge after 5000 iterations
  warnings.warn(message)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.8863 (correlation: 0.7726) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  üî¨ SYNTHETIC FMS: 0.4963 (poor recovery with 10% noise)
     ‚Ü≥ Tests factor recovery robustness
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 25 ---
  Loaded factor matrices - Genes: (10223, 25), Samples: (28, 25), Time: (4, 25)
  Running synthetic validation (this may take 1-2 minutes)...
/home/shared/barnacle/barnacle/decomposition.py:268: UserWarning: Algorithm failed to converge after 5000 iterations
  warnings.warn(message)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.9059 (correlation: 0.8118) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  üî¨ SYNTHETIC FMS: 0.6034 (fair recovery with 10% noise)
     ‚Ü≥ Tests factor recovery robustness
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 35 ---
  Loaded factor matrices - Genes: (10223, 35), Samples: (28, 35), Time: (4, 35)
  Running synthetic validation (this may take 1-2 minutes)...
/home/shared/barnacle/barnacle/decomposition.py:268: UserWarning: Algorithm failed to converge after 5000 iterations
  warnings.warn(message)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.9341 (correlation: 0.8681) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  üî¨ SYNTHETIC FMS: 0.5673 (fair recovery with 10% noise)
     ‚Ü≥ Tests factor recovery robustness
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 45 ---
  Loaded factor matrices - Genes: (10223, 45), Samples: (28, 45), Time: (4, 45)
  Running synthetic validation (this may take 1-2 minutes)...
/home/shared/barnacle/barnacle/decomposition.py:268: UserWarning: Algorithm failed to converge after 5000 iterations
  warnings.warn(message)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.9533 (correlation: 0.9066) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  üî¨ SYNTHETIC FMS: 0.5851 (fair recovery with 10% noise)
     ‚Ü≥ Tests factor recovery robustness
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 55 ---
  Loaded factor matrices - Genes: (10223, 55), Samples: (28, 55), Time: (4, 55)
  Running synthetic validation (this may take 1-2 minutes)...
/home/shared/barnacle/barnacle/decomposition.py:268: UserWarning: Algorithm failed to converge after 5000 iterations
  warnings.warn(message)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.9663 (correlation: 0.9326) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  üî¨ SYNTHETIC FMS: 0.4969 (poor recovery with 10% noise)
     ‚Ü≥ Tests factor recovery robustness
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 65 ---
  Loaded factor matrices - Genes: (10223, 65), Samples: (28, 65), Time: (4, 65)
  Running synthetic validation (this may take 1-2 minutes)...
/home/shared/barnacle/barnacle/decomposition.py:268: UserWarning: Algorithm failed to converge after 5000 iterations
  warnings.warn(message)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.9761 (correlation: 0.9523) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  üî¨ SYNTHETIC FMS: 0.5136 (fair recovery with 10% noise)
     ‚Ü≥ Tests factor recovery robustness
  Saved FMS results to: factor_match_score.json

--- Evaluating FMS for Rank 75 ---
  Loaded factor matrices - Genes: (10223, 75), Samples: (28, 75), Time: (4, 75)
  Running synthetic validation (this may take 1-2 minutes)...
/home/shared/barnacle/barnacle/decomposition.py:268: UserWarning: Algorithm failed to converge after 5000 iterations
  warnings.warn(message)
  TLViz FMS: 1.0000 ‚ö†Ô∏è  (self-consistency check only)
  ‚≠ê RECONSTRUCTION FMS: 0.9838 (correlation: 0.9676) ‚≠ê
     ‚Ü≥ Primary metric for rank selection
     ‚Ü≥ Valid elements used: 1,144,976
  üî¨ SYNTHETIC FMS: 0.4539 (poor recovery with 10% noise)
     ‚Ü≥ Tests factor recovery robustness
  Saved FMS results to: factor_match_score.json

============================================================
FMS RESULTS SUMMARY
============================================================
Saved FMS comparison table to: ../output/13.00-multiomics-barnacle/rank_comparison/factor_match_scores.csv

============================================================
FACTOR MATCH SCORE RESULTS
============================================================
‚ö†Ô∏è  NOTE: TLViz FMS compares decomposition to itself (always ~1.0)
‚≠ê  USE RECONSTRUCTION FMS for rank selection (compares to original tensor)
üî¨  SYNTHETIC FMS validates factor recovery robustness (optional)
============================================================
 rank  fms_tlviz  fms_reconstruction  reconstruction_correlation  fms_synthetic
    5     1.0000              0.7601                      0.5202         0.6170
    8     1.0000              0.8003                      0.6005         0.6859
   10     1.0000              0.8225                      0.6451         0.9071
   12     1.0000              0.8398                      0.6797         0.5074
   15     1.0000              0.8610                      0.7219         0.7324
   20     1.0000              0.8863                      0.7726         0.4963
   25     1.0000              0.9059                      0.8118         0.6034
   35     1.0000              0.9341                      0.8681         0.5673
   45     1.0000              0.9533                      0.9066         0.5851
   55     1.0000              0.9663                      0.9326         0.4969
   65     1.0000              0.9761                      0.9523         0.5136
   75     1.0000              0.9838                      0.9676         0.4539

============================================================
‚ö†Ô∏è  WARNING: TLViz FMS shows all values near 1.0
============================================================
This indicates self-comparison (decomposition vs itself).
This is NOT useful for rank selection.
‚Üí USE RECONSTRUCTION FMS instead (varies by rank: 0.76-0.98)
============================================================
[<matplotlib.lines.Line2D object at 0x77c0461f62d0>]
[<matplotlib.lines.Line2D object at 0x77c03dd0b3d0>]
Text(0.5, 0, 'Rank (Number of Components)')
Text(0, 0.5, 'Factor Match Score')
Text(0.5, 1.0, 'Factor Match Score vs Rank\n(Higher = Better Factor Recovery)')
<matplotlib.legend.Legend object at 0x77c045f22010>
(0.0, 1.05)
[<matplotlib.lines.Line2D object at 0x77c034e8ff50>]
<matplotlib.lines.Line2D object at 0x77c034e2dc50>
<matplotlib.lines.Line2D object at 0x77c03dd58e50>
Text(0.5, 0, 'Rank (Number of Components)')
Text(0, 0.5, 'Reconstruction Correlation')
Text(0.5, 1.0, 'Tensor Reconstruction Quality vs Rank\n(Correlation between original and reconstructed)')
<matplotlib.legend.Legend object at 0x77c03dd72150>
(-1.05, 1.05)
Saved FMS plot to: ../output/13.00-multiomics-barnacle/rank_comparison/factor_match_scores_plot.png

============================================================
FMS-BASED RANK RECOMMENDATION
============================================================
Best Reconstruction FMS: Rank 75 (score: 0.9838)
Best Reconstruction Correlation: Rank 75 (score: 0.9676)
Best TLViz FMS: Rank 10 (score: 1.0000)

High-scoring ranks (top 20%): [55, 65, 75]
Threshold: 0.9637

FMS Interpretation:
‚Ä¢ Reconstruction FMS is the PRIMARY metric for rank selection
  - Measures tensor reconstruction quality (0-1 scale)
  - Based on correlation between original and decomposed tensors
‚Ä¢ Reconstruction correlation shows direct fit quality (-1 to 1)
  - Values > 0.9 indicate excellent reconstruction
  - Values > 0.8 indicate good reconstruction
‚Ä¢ Higher scores = better factor recovery and model fit
‚Ä¢ Consider ranks with consistently high Reconstruction FMS (top 20%)
‚Ä¢ TLViz FMS available and can be used for additional validation

============================================================
FACTOR MATCH SCORE EVALUATION COMPLETE
============================================================
Summary: 12/12 ranks have valid Reconstruction FMS
         12/12 ranks have valid TLViz FMS
‚Üí Use Reconstruction FMS and correlation for rank selection

============================================================
SYNTHETIC FMS ELBOW PLOT (STANDALONE)
============================================================
Loading FMS results from: ../output/13.00-multiomics-barnacle/rank_comparison/factor_match_scores.csv
Loaded FMS data for 12 ranks
Columns available: ['rank', 'fms_tlviz', 'fms_reconstruction', 'fms_synthetic', 'reconstruction_correlation', 'tlviz_success', 'reconstruction_success', 'synthetic_success', 'tlviz_method', 'reconstruction_method', 'synthetic_method', 'valid_elements']
Found 12 ranks with valid synthetic FMS
[<matplotlib.lines.Line2D object at 0x77c03dd562d0>]
[<matplotlib.lines.Line2D object at 0x77c0463b6d50>]
[<matplotlib.lines.Line2D object at 0x77c034d4fad0>]
[<matplotlib.lines.Line2D object at 0x77c034d64f90>]
Text(0.5, 0, 'Rank (Number of Components)')
Text(0, 0.5, 'Factor Match Score')
Text(0.5, 1.0, 'Factor Match Score Comparison: Finding the Elbow\nSynthetic FMS peaks at optimal rank, then declines (overfitting)')
<matplotlib.legend.Legend object at 0x77c034efc050>
(0.0, 1.05)
<matplotlib.lines.Line2D object at 0x77c034ee8690>
Text(74.575, 0.91, 'Excellent (>0.9)')
<matplotlib.lines.Line2D object at 0x77c034d6f650>
Text(74.575, 0.71, 'Good (>0.7)')
<matplotlib.lines.Line2D object at 0x77c03dd1c990>
Text(74.575, 0.51, 'Fair (>0.5)')
[<matplotlib.lines.Line2D object at 0x77c034d7dd90>]
[<matplotlib.lines.Line2D object at 0x77c034d7e750>]
<matplotlib.lines.Line2D object at 0x77c034d4da90>
Text(10, 0.48123809137542917, 'Optimal\nRank 10')
Text(6.5, 0.879785657206089, 'Underfitting\n(Too simple)')
Text(35.0, 0.879785657206089, 'Overfitting\n(Capturing noise)')
Text(0.5, 0, 'Rank (Number of Components)')
Text(0, 0.5, 'Synthetic Validation FMS')
Text(0.5, 1.0, 'Synthetic FMS: Factor Recovery Test\nPeak indicates optimal balance between fit and stability')
(0.35389934436773185, 1.05)
<matplotlib.lines.Line2D object at 0x77c034d8a610>
<matplotlib.lines.Line2D object at 0x77c034d8b350>
<matplotlib.lines.Line2D object at 0x77c034d8bc90>
<string>:138: UserWarning: Glyph 128300 (\N{MICROSCOPE}) missing from font(s) DejaVu Sans.
<string>:138: UserWarning: Glyph 11088 (\N{WHITE MEDIUM STAR}) missing from font(s) DejaVu Sans.
<string>:140: UserWarning: Glyph 128300 (\N{MICROSCOPE}) missing from font(s) DejaVu Sans.
<string>:140: UserWarning: Glyph 11088 (\N{WHITE MEDIUM STAR}) missing from font(s) DejaVu Sans.

‚úì Saved Synthetic FMS elbow plot to: ../output/13.00-multiomics-barnacle/rank_comparison/synthetic_fms_elbow_plot.png

============================================================
SYNTHETIC FMS ELBOW ANALYSIS
============================================================
Optimal Rank: 10 (FMS = 0.9071)

Complete Synthetic FMS Results:
Rank     Synthetic FMS   Quality      Status
-------- --------------- ------------ --------------------
5        0.6170          Fair         
8        0.6859          Fair         
10       0.9071          Excellent    ‚òÖ OPTIMAL
12       0.5074          Fair         
15       0.7324          Good         
20       0.4963          Poor         
25       0.6034          Fair         
35       0.5673          Fair         
45       0.5851          Fair         
55       0.4969          Poor         
65       0.5136          Fair         
75       0.4539          Poor         

Interpretation:
  ‚Ä¢ Synthetic FMS tests factor recovery from noisy data
  ‚Ä¢ Peak at rank 10 indicates best balance:
    - Sufficient complexity to capture patterns
    - Robust enough to avoid overfitting noise
  ‚Ä¢ Higher ranks show declining FMS (overfitting)
  ‚Ä¢ Lower ranks show lower FMS (underfitting)

Statistics:
  ‚Ä¢ Improvement to optimal: +0.2213
  ‚Ä¢ Average FMS after optimal: 0.5507
  ‚Ä¢ Decline from peak: -0.3564

============================================================

SYNTHETIC FMS ELBOW PLOT GENERATION COMPLETE
============================================================
